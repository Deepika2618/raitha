<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Raitha Bandhu - Register</title>
  <style>
    body {
      font-family: Poppins, Arial, sans-serif;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: url("https://www.shutterstock.com/shutterstock/videos/1100836971/thumb/1.jpg?ip=x480") 
        no-repeat center center fixed;
      background-size: cover;
    }
    h1 {
      text-align: center;
      color: #fff;
      margin: 20px 0;
      font-size: 2.2rem;
      text-shadow: 0 0 8px rgba(0,0,0,0.8);
    }
    .lang-select {
      position: absolute;
      top: 12px;
      right: 16px;
      background: rgba(255,255,255,0.9);
      padding: 6px 10px;
      border-radius: 8px;
      font-size: 14px;
      border: 1px solid #cbd5e1;
    }
    .container {
      flex: 1;
      display: flex;
      justify-content: flex-start;
      align-items: center;
      padding: 40px;
    }
    .card {
      background: rgba(255,255,255,0.92);
      padding: 28px 26px;
      border-radius: 16px;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.25);
      width: min(92vw, 360px);
      animation: slideIn 0.8s ease;
    }
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    label {
      display: block;
      margin: 10px 0 6px;
      color: #065f46;
      font-weight: 600;
    }
    input, select {
      padding: 10px 12px;
      border: 1px solid #cbd5e1;
      border-radius: 10px;
      font-size: 14px;
    }
    .error {
      color: red;
      font-size: 13px;
      margin-top: 4px;
      display: none;
    }
    .voice-btn {
      width: 18%;
      padding: 10px;
      margin-left: 5px;
      border: none;
      border-radius: 10px;
      background: #22c55e;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }
    .voice-btn:hover {
      background: #16a34a;
    }
    button {
      width: 100%;
      margin-top: 14px;
      padding: 12px;
      border: 0;
      border-radius: 12px;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #fff;
      font-weight: 700;
      cursor: pointer;
      font-size: 15px;
      transition: background 0.3s ease;
    }
    button:hover {
      background: linear-gradient(135deg, #16a34a, #15803d);
    }
    .muted {
      text-align: center;
      margin-top: 12px;
      color: #475569;
    }
    .showpass {
      font-size: 13px;
      margin-left: 8px;
      cursor: pointer;
    }
    .phone-container {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    select#country_code {
      width: 35%;
    }
    input#reg_phone {
      width: 45%;
    }
  </style>
</head>
<body>

  <select class="lang-select" onchange="switchLanguage(this.value)">
    <option value="en">English</option>
    <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
    <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
    <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
  </select>

  <h1>Welcome to Raitha Bandhu</h1>

  <div class="container">
    <div class="card">
      <h2 id="register_title">Create Account</h2>

      <form onsubmit="return handleRegister(event)" autocomplete="off">
        <label id="lbl_user">Username</label>
        <div style="display:flex;align-items:center;">
          <input id="reg_user" type="text" onfocus="speakKey('enter_username')" required/>
          <button type="button" class="voice-btn" onclick="startListening('reg_user')">üé§</button>
        </div>

        <label id="lbl_phone">Phone Number</label>
        <div class="phone-container">
          <select id="country_code">
            <option value="+91"> +91 (India)</option>
            <option value="+44"> +44 (UK)</option>
            <option value="+1"> +1 (USA)</option>
            <option value="+61"> +61 (Australia)</option>
            <option value="+81"> +81 (Japan)</option>
            <option value="+971"> +971 (UAE)</option>
          </select>
          <input 
            id="reg_phone" 
            type="tel" 
            onfocus="speakKey('enter_phone')" 
            maxlength="12"
            placeholder="Enter number (digits only)"
            required
          />
          <button type="button" class="voice-btn" onclick="startListening('reg_phone')">üé§</button>
        </div>
        <p id="phone_error" class="error">‚ö†Ô∏è Please enter a valid phone number (10 digits, starts 6‚Äì9 for India).</p>

        <label id="lbl_pass">Password</label>
        <div style="display:flex;align-items:center;">
          <input id="reg_pass" type="password" onfocus="speakKey('enter_password')" required/>
          <button type="button" class="voice-btn" onclick="startListening('reg_pass')">üé§</button>
        </div>
        <div class="showpass">
          <input type="checkbox" id="show_password" onclick="togglePassword()"> Show Password
        </div>

        <button type="submit" id="btn_register">Register</button>
      </form>

      <p class="muted">
        <span id="have_account">Already have an account?</span>
        <a href="login.html" id="login_link">Login</a>
      </p>
    </div>
  </div>

  <script>
    const t = {
      en:{register_title:"Create Account",username:"Username",phone:"Phone Number",password:"Password",
          register_btn:"Register",enter_username:"Enter your username",enter_phone:"Enter your phone number",
          enter_password:"Enter your password",register_success:"Registration successful",
          register_fail:"Please fill all fields correctly",invalid_phone:"Please enter a valid phone number.",
          have_account:"Already have an account?",login_link:"Login"},
      hi:{register_title:"‡§ñ‡§æ‡§§‡§æ ‡§¨‡§®‡§æ‡§è‡§Å",username:"‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§æ‡§Æ",phone:"‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞",password:"‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°",
          register_btn:"‡§∞‡§ú‡§ø‡§∏‡•ç‡§ü‡§∞ ‡§ï‡§∞‡•á‡§Ç",enter_username:"‡§Ö‡§™‡§®‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç",
          enter_phone:"‡§Ö‡§™‡§®‡§æ ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç",enter_password:"‡§Ö‡§™‡§®‡§æ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç",
          register_success:"‡§™‡§Ç‡§ú‡•Ä‡§ï‡§∞‡§£ ‡§∏‡§´‡§≤ ‡§π‡•Å‡§Ü",register_fail:"‡§∏‡§≠‡•Ä ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§∏‡§π‡•Ä ‡§¢‡§Ç‡§ó ‡§∏‡•á ‡§≠‡§∞‡•á‡§Ç",
          invalid_phone:"‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§π‡•Ä ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç‡•§",have_account:"‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§è‡§ï ‡§ñ‡§æ‡§§‡§æ ‡§π‡•à?",
          login_link:"‡§≤‡•â‡§ó‡§ø‡§®"},
      kn:{register_title:"‡≤ñ‡≤æ‡≤§‡≥Ü ‡≤∏‡≥É‡≤∑‡≥ç‡≤ü‡≤ø‡≤∏‡≤ø",username:"‡≤¨‡≤≥‡≤ï‡≥Ü‡≤¶‡≤æ‡≤∞‡≤∞ ‡≤π‡≥Ü‡≤∏‡≤∞‡≥Å",phone:"‡≤´‡≥ã‡≤®‡≥ç ‡≤∏‡≤Ç‡≤ñ‡≥ç‡≤Ø‡≥Ü",password:"‡≤™‡≤æ‡≤∏‡≥ç‡≤µ‡≤∞‡≥ç‡≤°‡≥ç",
          register_btn:"‡≤®‡≥ã‡≤Ç‡≤¶‡≤£‡≤ø",enter_username:"‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤¨‡≤≥‡≤ï‡≥Ü‡≤¶‡≤æ‡≤∞‡≤∞ ‡≤π‡≥Ü‡≤∏‡≤∞‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≤Æ‡≥Ç‡≤¶‡≤ø‡≤∏‡≤ø",
          enter_phone:"‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤´‡≥ã‡≤®‡≥ç ‡≤∏‡≤Ç‡≤ñ‡≥ç‡≤Ø‡≥Ü‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≤Æ‡≥Ç‡≤¶‡≤ø‡≤∏‡≤ø",enter_password:"‡≤®‡≤ø‡≤Æ‡≥ç‡≤Æ ‡≤™‡≤æ‡≤∏‡≥ç‡≤µ‡≤∞‡≥ç‡≤°‡≥ç ‡≤®‡≤Æ‡≥Ç‡≤¶‡≤ø‡≤∏‡≤ø",
          register_success:"‡≤®‡≥ã‡≤Ç‡≤¶‡≤£‡≤ø ‡≤Ø‡≤∂‡≤∏‡≥ç‡≤µ‡≤ø‡≤Ø‡≤æ‡≤Ø‡≤ø‡≤§‡≥Å",register_fail:"‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å ‡≤é‡≤≤‡≥ç‡≤≤‡≤æ ‡≤ï‡≥ç‡≤∑‡≥á‡≤§‡≥ç‡≤∞‡≤ó‡≤≥‡≤®‡≥ç‡≤®‡≥Å ‡≤∏‡≤∞‡≤ø‡≤Ø‡≤æ‡≤ó‡≤ø ‡≤§‡≥Å‡≤Ç‡≤¨‡≤ø",
          invalid_phone:"‡≤¶‡≤Ø‡≤µ‡≤ø‡≤ü‡≥ç‡≤ü‡≥Å ‡≤∏‡≤∞‡≤ø‡≤Ø‡≤æ‡≤¶ ‡≤´‡≥ã‡≤®‡≥ç ‡≤∏‡≤Ç‡≤ñ‡≥ç‡≤Ø‡≥Ü‡≤Ø‡≤®‡≥ç‡≤®‡≥Å ‡≤®‡≤Æ‡≥Ç‡≤¶‡≤ø‡≤∏‡≤ø.",have_account:"‡≤à‡≤ó‡≤æ‡≤ó‡≤≤‡≥á ‡≤ñ‡≤æ‡≤§‡≥Ü ‡≤á‡≤¶‡≥Ü‡≤Ø‡≥á?",
          login_link:"‡≤≤‡≤æ‡≤ó‡≤ø‡≤®‡≥ç"},
      bn:{register_title:"‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®",username:"‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ",phone:"‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞",
          password:"‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°",register_btn:"‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶®",enter_username:"‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®",
          enter_phone:"‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®",enter_password:"‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®",
          register_success:"‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶® ‡¶∏‡¶´‡¶≤ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá",register_fail:"‡¶∏‡¶¨ ‡¶ï‡ßç‡¶∑‡ßá‡¶§‡ßç‡¶∞ ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®",
          invalid_phone:"‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶†‡¶ø‡¶ï ‡¶´‡ßã‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§",have_account:"‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá‡¶á ‡¶è‡¶ï‡¶ü‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶õ‡ßá?",
          login_link:"‡¶≤‡¶ó‡¶á‡¶®"}
    };

    let currentLang = localStorage.getItem("rb_lang") || "en";

    function setLang(l){
      currentLang = l;
      localStorage.setItem("rb_lang", l);
      const dict = t[l];
      document.getElementById("register_title").innerText = dict.register_title;
      document.getElementById("lbl_user").innerText = dict.username;
      document.getElementById("lbl_phone").innerText = dict.phone;
      document.getElementById("lbl_pass").innerText = dict.password;
      document.getElementById("btn_register").innerText = dict.register_btn;
      document.getElementById("have_account").innerText = dict.have_account;
      document.getElementById("login_link").innerText = dict.login_link;
    }

    function switchLanguage(lang){ setLang(lang); }
    function speakKey(k){ speak(t[currentLang][k]); }
    function speak(msg){
      if(!msg) return;
      const u = new SpeechSynthesisUtterance(msg);
      u.lang = currentLang==="hi"?"hi-IN":currentLang==="kn"?"kn-IN":currentLang==="bn"?"bn-IN":"en-US";
      speechSynthesis.speak(u);
    }

    function startListening(inputId){
      if(!('webkitSpeechRecognition' in window)){
        alert("Speech recognition not supported in this browser.");
        return;
      }
      const recognition = new webkitSpeechRecognition();
      recognition.lang = currentLang==="hi"?"hi-IN":currentLang==="kn"?"kn-IN":currentLang==="bn"?"bn-IN":"en-US";
      recognition.start();
      recognition.onresult = function(event){
        const result = event.results[0][0].transcript;
        document.getElementById(inputId).value = result;
      };
    }

    function handleRegister(e){
      e.preventDefault();

      const u = document.getElementById('reg_user').value.trim();
      const cc = document.getElementById('country_code').value;
      const ph = document.getElementById('reg_phone').value.trim();
      const p = document.getElementById('reg_pass').value;
      const phoneError = document.getElementById('phone_error');
      phoneError.style.display = "none";

      if(!u || !ph || !p){
        speakKey('register_fail');
        alert(t[currentLang].register_fail);
        return false;
      }

      // keep India-style validation as before: 10 digits starting with 6-9
      if(!/^[6-9]\d{9}$/.test(ph)){
        phoneError.style.display = "block";
        phoneError.innerText = "‚ö†Ô∏è " + "Number does not exist. Enter a valid 10-digit number .";
        speak("Number does not exist. Enter a valid phone number .");
        return false;
      }

      const fullPhone = cc + ph;

      // Robust parsing & normalization of stored users
      let usersRaw = localStorage.getItem('rb_users');
      let users = [];
      if(usersRaw){
        try {
          const parsed = JSON.parse(usersRaw);
          if(Array.isArray(parsed)){
            // normalize each item to object {u, ph, p}
            users = parsed.map(item => {
              if(!item) return {u:'', ph:'', p:''};
              if(typeof item === 'string') return {u: item, ph:'', p:''};
              if(typeof item === 'object'){
                return {
                  u: item.u ? String(item.u) : '',
                  ph: item.ph ? String(item.ph) : '',
                  p: item.p ? String(item.p) : ''
                };
              }
              return {u:'', ph:'', p:''};
            });
          } else {
            // not an array -> clear it and start fresh
            users = [];
            localStorage.removeItem('rb_users');
          }
        } catch(err){
          // corrupted JSON - clear and start empty
          users = [];
          localStorage.removeItem('rb_users');
        }
      }

      // check duplicate username (case-insensitive) and duplicate phone (exact)
      const usernameExists = users.some(x => {
        if(!x.u) return false;
        return x.u.toLowerCase() === u.toLowerCase();
      });
      if(usernameExists){
        alert("Username already exists! Try another one.");
        return false;
      }
      const phoneExists = users.some(x => (x.ph || '') === fullPhone);
      if(phoneExists){
        alert("Phone number already registered!");
        return false;
      }

      // push new normalized object
      users.push({u: u, ph: fullPhone, p: p});
      localStorage.setItem('rb_users', JSON.stringify(users));

      speakKey('register_success');
      alert(t[currentLang].register_success);

      // redirect to login page
      window.location.href = 'login.html';
      return false;
    }

    function togglePassword(){
      const pass = document.getElementById('reg_pass');
      pass.type = pass.type === "password" ? "text" : "password";
    }

    // digit-only enforcement for phone field and init language
    document.addEventListener("DOMContentLoaded", ()=>{
      const phone = document.getElementById("reg_phone");
      phone.addEventListener("input", ()=> phone.value = phone.value.replace(/[^0-9]/g, ""));
      document.querySelector(".lang-select").value = currentLang;
      setLang(currentLang);
      speak("Welcome to Raitha Bandhu. ");
    });
  </script>
</body>
</html>
